<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Srijan 2019 | Campus Ambassador</title>
</head>
<script>
    function validateData(name, phone, inst) {
        var errors = {};
        if (name == "") {
            errors["name"] = "Please enter name";
        } else if (name.split(" ").length < 2) {
            errors["name"] = "Please enter fullname";
        }
        if (phone == "") {
            errors["phone"] = "Please enter phone number";
        } else if (phone.length != 10) {
            errors["phone"] = "Please enter 10 digit phone number";
        } else if (phone.match(/^\d{10}$/) === null) {
            errors["phone"] = "Please enter a valid 10 digit phone number";
        }
        if (inst == "") {
            errors["inst"] = "Please select an institution";
        }
        return errors;
    }
    function submitData() {
        var form = document.forms["campus_ambassador"];
        var form_name = form["name"].value;
        var form_phone = form["phone"].value;
        var form_institution = form["institution"].value;
        var form_errors = validateData(form_name, form_phone, form_institution);
        if (form_errors["name"] === undefined && form_errors["phone"] === undefined && form_errors["inst"] === undefined) {
            var request = new XMLHttpRequest();
            request.addEventListener("load", function(e) {
                var response = JSON.parse(request.responseText);
                if (request.status === 200) {
                    console.log("Success:", response);
                } else {
                    console.log("Error:", response);
                }
            });
            request.addEventListener("error", function(e) {
                console.log("Error:", e);
            });
            request.open("POST", "https://srijan2019-b0bbc.firebaseio.com/campus_ambassador/"+form_institution+".json");
            request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            var send_json = JSON.stringify({"name": form_name, "phone": form_phone});
            console.log(send_json);
            request.send(send_json);
        } else {
            console.log(form_errors);
        }
        return false;
    }
    window.onload = function(e) {
        var ins_dropdown = document.forms["campus_ambassador"]["institution"];
        var request = new XMLHttpRequest();
        request.addEventListener("load", function(e) {
            var response = JSON.parse(request.responseText);
            for (var key in response) {
                var ins_option = document.createElement("option");
                ins_option.value = key;
                ins_option.text = response[key];
                ins_dropdown.add(ins_option);
            }
        });
        request.addEventListener("error", function(e) {
            console.log("Error fetching institution names");
        });
        request.open("GET", "https://srijan2019-b0bbc.firebaseio.com/institutions.json", true);
        request.send();
    }
</script>
<body>
    <form action="" name="campus_ambassador" onsubmit="return submitData()">
        <input type="string" placeholder="Name" name="name" /> <br />
        <input type="string" placeholder="Phone" name="phone" /> <br />
        <select name="institution" >
            <option value="" disabled selected>Institution</option>
        </select> <br />
        <input type="submit" value="Submit" />
    </form>
</body>
</html>
